import{s}from"./supabase-CODpAGvx.js";const v=document.getElementById("navbar"),d=document.getElementById("openAuth"),g=document.getElementById("authModal"),E=document.querySelector(".close-modal"),y=document.querySelectorAll(".auth-tab"),q=document.querySelectorAll(".auth-form");document.querySelector(".nav-links");const m=document.getElementById("contactForm"),p=document.getElementById("loginForm"),L=document.getElementById("signupForm"),I=document.getElementById("googleLogin"),A=document.querySelectorAll(".password-toggle");let r=null;window.addEventListener("scroll",()=>{window.scrollY>50?v.classList.add("scrolled"):v.classList.remove("scrolled")});document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(n){const t=this.getAttribute("href");if(t==="#"||!t||t.startsWith("http"))return;n.preventDefault();const a=document.querySelector(t);a&&a.scrollIntoView({behavior:"smooth"})})});const l=e=>{e?g.classList.add("active"):g.classList.remove("active")};d&&d.addEventListener("click",()=>{r?window.location.href="dashboard.html":l(!0)});E&&E.addEventListener("click",()=>l(!1));window.addEventListener("click",e=>{e.target===g&&l(!1)});y.forEach(e=>{e.addEventListener("click",()=>{const n=e.getAttribute("data-tab");y.forEach(t=>t.classList.remove("active")),q.forEach(t=>t.classList.remove("active")),e.classList.add("active"),document.getElementById(`${n}Form`).classList.add("active")})});const w=async e=>{var n;if(r=e,!!d)if(e){const{data:t}=await s.from("profiles").select("full_name").eq("id",e.id).single(),a=(t==null?void 0:t.full_name)||((n=e.user_metadata)==null?void 0:n.full_name)||e.email;if(d.innerText=`Olá, ${a.split(" ")[0]}`,!document.getElementById("navDashboard")){const i=document.createElement("li");i.id="navDashboard",i.innerHTML='<a href="dashboard.html" style="color: var(--primary);">Meu Painel</a>',document.querySelector(".nav-links").appendChild(i)}}else{d.innerText="Login / Cadastro";const t=document.getElementById("navDashboard");t&&t.remove()}},u=async()=>{if(!r){document.querySelectorAll(".cart-badge").forEach(t=>t.innerText="0");return}const{count:e,error:n}=await s.from("cart").select("*",{count:"exact",head:!0}).eq("user_id",r.id);n||document.querySelectorAll(".cart-badge").forEach(t=>t.innerText=e||0)},T=async()=>{const{data:{session:e}}=await s.auth.getSession();r=(e==null?void 0:e.user)||null,w(r),u(),s.auth.onAuthStateChange((n,t)=>{r=(t==null?void 0:t.user)||null,w(r),u()})};I&&I.addEventListener("click",async()=>{const{error:e}=await s.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}});e&&alert("Erro ao entrar com Google: "+e.message)});if(L){const e=document.getElementById("signupPass"),n=document.getElementById("signupConfirmPass"),t=document.querySelector(".strength-bar"),a=document.querySelector(".strength-text"),i=o=>{let c=0;o.length>5&&c++,o.match(/[a-z]/)&&o.match(/[A-Z]/)&&c++,o.match(/[0-9]/)&&o.match(/[^a-zA-Z0-9]/)&&c++,t.className="strength-bar",o.length===0?a.innerText="Força da senha":c===1?(t.classList.add("strength-weak"),a.innerText="Senha Fraca"):c===2?(t.classList.add("strength-medium"),a.innerText="Senha Média"):c===3&&(t.classList.add("strength-strong"),a.innerText="Senha Forte")};e.addEventListener("input",o=>i(o.target.value)),L.addEventListener("submit",async o=>{o.preventDefault();const c=document.getElementById("signupName").value,b=document.getElementById("signupEmail").value,f=e.value,S=n.value;if(f!==S){alert("As senhas não coincidem!");return}const{error:h}=await s.auth.signUp({email:b,password:f,options:{data:{full_name:c}}});h?alert("Erro no Cadastro: "+h.message):(alert(`Verifique seu e-mail para confirmar o cadastro, ${c}!`),l(!1))})}p&&p.addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("loginEmail").value,t=document.getElementById("loginPass").value,{error:a}=await s.auth.signInWithPassword({email:n,password:t});a?alert("Erro no Login: "+a.message):l(!1)});m&&m.addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("name").value,t=document.getElementById("email").value,a=document.getElementById("service").value,i=document.getElementById("message").value,{error:o}=await s.from("quotes").insert([{user_id:(r==null?void 0:r.id)||null,client_name:n,client_email:t,service:a,details:i,status:"Pendente"}]);o?alert("Erro ao enviar: "+o.message):(alert("Orçamento solicitado com sucesso!"),m.reset())});const B=async(e,n=null,t=1)=>{if(!r){alert("Por favor, faça login para adicionar itens ao carrinho."),l(!0);return}const{data:a}=await s.from("products").select("id").eq("name",e).single();if(a){const i={user_id:r.id,product_id:a.id,variation_id:n,quantity:t},{error:o}=await s.from("cart").insert([i]);o?alert("Erro ao adicionar ao carrinho: "+o.message):(alert(`${t}x ${e} adicionado ao seu carrinho!`),u())}};window.addToCart=B;window.updateCartUI=u;document.querySelectorAll(".product-card .btn").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const t=e.parentElement.querySelector("h3").innerText;B(t)})});A.forEach(e=>{e.addEventListener("click",()=>{const n=e.parentElement.querySelector("input");n.type==="password"?(n.type="text",e.classList.add("visible")):(n.type="password",e.classList.remove("visible"))})});T();console.log("SE7ENGEN Enhanced UI Logic Initialized");
